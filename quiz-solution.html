<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Soluzione quiz ¬∑ Badiani</title>
  <link rel="stylesheet" href="styles/site.css?v=20260108_1" />
  <script defer src="scripts/i18n.js?v=20260103_3"></script>
  <script defer src="scripts/i18n-manager.js?v=20260103_2"></script>
  <style>
    body { background: var(--paper); }
    .solution-shell {
      max-width: 880px;
      margin: 80px auto;
      padding: 32px 28px;
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: 0 26px 60px rgba(15, 33, 84, 0.12);
    }
    .solution-eyebrow {
      font-size: 13px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--brand-rose);
      margin-bottom: 12px;
      font-family: var(--font-medium);
    }
    .solution-title {
      font-size: 28px;
      color: var(--ink);
      margin: 0 0 10px;
    }
    .solution-question {
      font-size: 20px;
      color: var(--ink);
      margin: 18px 0;
      line-height: 1.6;
    }
    .solution-answer {
      font-size: 18px;
      color: var(--ink);
      padding: 18px 16px;
      background: rgba(236, 65, 140, 0.06);
      border-left: 4px solid var(--brand-rose);
      border-radius: 14px;
      line-height: 1.65;
    }
    .solution-note {
      margin-top: 14px;
      padding: 16px;
      border-radius: 14px;
      border: 1px solid rgba(33, 64, 152, 0.14);
      background: rgba(33, 64, 152, 0.04);
      color: var(--ink);
      line-height: 1.65;
      font-size: 16px;
    }
    .solution-revisions {
      margin-top: 20px;
      padding: 16px;
      border-radius: 12px;
      background: rgba(227, 6, 19, 0.06);
      border-left: 4px solid #E30613;
    }
    .solution-revisions-title {
      font-weight: 600;
      color: #E30613;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      margin-bottom: 12px;
    }
    .solution-revisions-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .solution-revisions-link {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 14px;
      background: #fff;
      border: 1px solid #E30613;
      color: #E30613;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.15s ease;
    }
    .solution-revisions-link:hover {
      background: #E30613;
      color: #fff;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(227, 6, 19, 0.24);
    }
    .solution-actions a {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 12px 16px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      letter-spacing: 0.04em;
      border: 1px solid rgba(33, 64, 152, 0.2);
      color: var(--ink);
      background: rgba(33, 64, 152, 0.05);
      transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }
    .solution-actions a:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(15, 33, 84, 0.14); border-color: var(--brand-blue); }
    .solution-empty { color: var(--brand-gray); font-size: 17px; }
  </style>
</head>
<body>
  <main class="solution-shell">
    <p class="solution-eyebrow" data-i18n="quizSolution.eyebrow">Quiz ¬∑ Soluzione</p>
    <h1 class="solution-title" data-i18n="quizSolution.title">Rivedi la risposta corretta</h1>
    <p class="solution-question" data-solution-question data-i18n="quizSolution.loadingQuestion">Caricamento domanda...</p>
    <div class="solution-answer" data-solution-answer data-i18n="quizSolution.loadingAnswer">Caricamento risposta corretta...</div>
    <div class="solution-note" data-solution-explain hidden><strong data-i18n="quizSolution.explainLabel">Spiegazione:</strong> <span data-solution-explain-text></span></div>
    <div class="solution-note" data-solution-tip hidden><strong data-i18n="quizSolution.tipLabel">Suggerimento:</strong> <span data-solution-tip-text></span></div>
    <div class="solution-revisions" data-solution-revisions hidden>
      <div class="solution-revisions-title">üìö Berny consiglia di rivedere:</div>
      <div class="solution-revisions-list" data-solution-revisions-list></div>
    </div>
    <div class="solution-actions">
      <a href="index.html" data-i18n="quizSolution.backHub">‚¨Ö Torna all'hub</a>
      <a href="#" data-solution-spec hidden data-i18n="quizSolution.openSpecs">üìñ Apri specifiche</a>
      <a href="javascript:history.back()" data-i18n="quizSolution.back">‚Ü© Torna indietro</a>
    </div>
  </main>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const t = (key, vars, fallback) => {
        try {
          if (window.BadianiI18n && typeof window.BadianiI18n.t === 'function') {
            const res = window.BadianiI18n.t(key, vars);
            return res || fallback || key;
          }
        } catch (e) {}
        return fallback || key;
      };

      const params = new URLSearchParams(window.location.search);
      const q = params.get('prompt');
      const a = params.get('answer');
      const explain = params.get('explain');
      const tip = params.get('tip');
      const spec = params.get('spec');
      const specLabel = params.get('specLabel');
      const revisions = params.get('revisions');
      
      const questionEl = document.querySelector('[data-solution-question]');
      const answerEl = document.querySelector('[data-solution-answer]');
      const explainWrap = document.querySelector('[data-solution-explain]');
      const explainText = document.querySelector('[data-solution-explain-text]');
      const tipWrap = document.querySelector('[data-solution-tip]');
      const tipText = document.querySelector('[data-solution-tip-text]');
      const specLink = document.querySelector('[data-solution-spec]');
      const revisionsWrap = document.querySelector('[data-solution-revisions]');
      const revisionsList = document.querySelector('[data-solution-revisions-list]');
      
      if (q && a) {
        questionEl.textContent = decodeURIComponent(q);
        answerEl.textContent = t('quizSolution.correctAnswerPrefix', null, 'Risposta corretta:') + ' ' + decodeURIComponent(a);

        if (explain && explainWrap && explainText) {
          explainText.textContent = decodeURIComponent(explain);
          explainWrap.hidden = false;
        }
        if (tip && tipWrap && tipText) {
          tipText.textContent = decodeURIComponent(tip);
          tipWrap.hidden = false;
        }
        if (spec && specLink) {
          const href = decodeURIComponent(spec);
          if (href) {
            specLink.href = href;
            if (specLabel) {
              try {
                specLink.textContent = `üìñ ${decodeURIComponent(specLabel)}`;
              } catch (e) {
                specLink.textContent = t('quizSolution.openSuggestedCard', null, 'üìñ Apri scheda consigliata');
              }
            }
            specLink.hidden = false;
          }
        }
        
        // Mostra le schede di revisione consigliate da Berny
        if (revisions && revisionsWrap && revisionsList) {
          try {
            console.log('üìö Parsing revisions:', revisions);
            const cardNames = JSON.parse(decodeURIComponent(revisions));
            console.log('üìö Parsed cardNames:', cardNames);
            
            if (Array.isArray(cardNames) && cardNames.length > 0) {
              // Mappa il nome della scheda ai file corretti (DEVE CORRISPONDERE a site.js slugToCardName)
              const cardLinks = {
                'Caff√®': { href: 'caffe.html', label: '‚òï Torna a Caff√®' },
                'Gelato Lab': { href: 'gelato-lab.html', label: 'üç¶ Torna a Gelato Lab' },
                'Dolciumi': { href: 'sweet-treats.html', label: 'üç∞ Torna a Dolciumi' },
                'Paste': { href: 'pastries.html', label: 'ü•ê Torna a Paste' },
                'Slitti Yoyo': { href: 'slitti-yoyo.html', label: 'üç´ Torna a Slitti Yoyo' },
                'Festivo': { href: 'festive.html', label: 'üéÑ Torna a Festivo' },
              };
              
              revisionsList.innerHTML = '';
              let linksCreated = 0;
              
              cardNames.forEach(cardName => {
                const trimmedName = (cardName || '').trim();
                const linkInfo = cardLinks[trimmedName];
                
                if (linkInfo) {
                  const link = document.createElement('a');
                  link.href = linkInfo.href;
                  link.className = 'solution-revisions-link';
                  link.textContent = linkInfo.label;
                  revisionsList.appendChild(link);
                  linksCreated++;
                  console.log(`‚úÖ Link creato per: ${trimmedName} -> ${linkInfo.href}`);
                } else {
                  console.warn(`‚ö†Ô∏è Nome scheda non mappato: "${trimmedName}"`);
                }
              });
              
              if (linksCreated > 0) {
                revisionsWrap.hidden = false;
                console.log(`‚úÖ Berny: ${linksCreated} schede di revisione consigliate`);
              } else {
                console.warn('‚ö†Ô∏è Nessun link creato - nomi non mappati');
                revisionsWrap.hidden = true;
              }
            } else {
              console.warn('‚ö†Ô∏è cardNames non √® un array o √® vuoto:', cardNames);
            }
          } catch (e) {
            console.error('‚ùå Errore parsing schede revisione:', e.message, 'revisions:', revisions);
          }
        } else {
          console.log('‚ÑπÔ∏è Nessun parametro revisions trovato');
        }
      } else {
        questionEl.textContent = t('quizSolution.noQuestion', null, 'Nessuna domanda ricevuta.');
        answerEl.textContent = t('quizSolution.retry', null, 'Riprova dal quiz.');
      }
    });
  </script>
</body>
</html>


