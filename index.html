<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Badiani Training Orbit</title>
    <link rel="icon" href="assets/brand/logo-b-blue.png" type="image/png" />
    <link rel="stylesheet" href="styles/site.css?v=20260102_6" />

    <!-- Importa SDK Ufficiale Google (Modul type="importmap" √® il modo moderno) -->
    <script type="importmap">
      {
        "imports": {
          "@google/generative-ai": "https://esm.run/@google/generative-ai@0.21.0"
        }
      }
    </script>
    <script type="module">
      // Load Google SDK only when running in SDK mode (proxy mode doesn't need it).
      (() => {
        let cfg = null;
        try { cfg = JSON.parse(localStorage.getItem('badianiBerny.config.v1') || 'null'); } catch { cfg = null; }
        const isProxy = !!(cfg && typeof cfg === 'object' && String(cfg.provider || '').toLowerCase() === 'proxy' && cfg.proxyEndpoint);
        if (isProxy) return;

        import("@google/generative-ai")
          .then(({ GoogleGenerativeAI }) => {
            window.GoogleGenerativeAI = GoogleGenerativeAI; // Rendilo globale per berny-brain-api.js
          })
          .catch((e) => {
            console.warn('Google Generative AI SDK failed to load (proxy recommended).', e);
          });
      })();
    </script>

    <script src="scripts/berny-knowledge.js?v=3"></script>
    <script src="scripts/berny-super-knowledge.js"></script>
    <script src="scripts/berny-brain-api.js?v=20260102_5"></script>
    <script src="scripts/berny-widget-controller.js?v=20260102_5"></script>
    <script defer src="scripts/i18n.js?v=20251228_4"></script>
    <script defer src="scripts/berny-ui.js?v=20260102_5"></script>
    <script defer src="scripts/avatar-lab.js"></script>
    <script defer src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script defer src="scripts/site.js?v=20260102_4"></script>
    <script defer src="scripts/gelato-effects.js?v=20251227_1"></script>
  <!-- COCKPIT_COMPACT block removed: styling now lives in styles/site.css -->

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Course",
        "name": "Badiani Training Orbit - Playbook Operativo",
        "description": "Corso di formazione interattivo per team Badiani 1932 su tradizione fiorentina, gelato artigianale e procedure operative",
        "provider": {
          "@type": "Organization",
          "name": "Badiani 1932",
          "url": "https://www.badiani1932.it"
        },
        "courseMode": "online",
        "educationalLevel": "Beginner to Advanced",
        "inLanguage": ["it", "en", "es", "fr"],
        "hasCourseInstance": [
          {
            "@type": "CourseInstance",
            "courseMode": "online",
            "courseWorkload": "PT2H"
          }
        ]
      }
    </script>
</head>
  <body class="page-home">
    <main>

      <!-- Loading overlay -->
      <div class="loading-overlay" data-loading hidden>
        <div class="loading-spinner" role="status">
          <span class="sr-only" data-i18n="loading.message">Caricamento in corso...</span>
        </div>
      </div>

      <!-- Error toast -->
      <div class="error-toast" data-error-toast hidden role="alert" aria-live="polite">
        <div class="error-toast__content">
          <svg class="error-toast__icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM9 9a1 1 0 012 0v4a1 1 0 11-2 0V9zm1-4a1 1 0 100 2 1 1 0 000-2z" />
          </svg>
          <p class="error-toast__message" data-error-message></p>
        </div>
        <button type="button" class="error-toast__close" data-error-close aria-label="Chiudi notifica">
          <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 4L4 12M4 4l8 8" />
          </svg>
        </button>
      </div>

      <nav class="nav-shell">
        <a class="brand" href="index.html" aria-label="Torna alla home Badiani" data-i18n-attr="aria-label:nav.homeAria">
          <img src="assets/brand/logo-badiani.jpg" data-default-src="assets/brand/logo-badiani.jpg" data-alt-src="assets/brand/logo-b-blue.png" alt="Badiani logo" class="brand-avatar" />
          <div class="brand-text">
            <small>Training</small>
          </div>
        </a>
        <div class="user-nickname-bar" id="user-nickname-bar" aria-label="Profilo utente" data-i18n-attr="aria-label:nav.profileAria">
          <span class="user-nickname-pill">
            <span class="user-nickname-pill__label" data-i18n="nav.profileLabel">Profilo</span>
            <span class="user-nickname-pill__value" id="nickname-display"></span>
          </span>
        </div>
        <button class="menu-trigger" type="button" data-menu-toggle aria-expanded="false" aria-controls="nav-panel">
          <span data-i18n="nav.menu">Menu</span>
          <span class="menu-icon" aria-hidden="true">
            <span></span>
            <span></span>
            <span></span>
          </span>
        </button>
        <div class="menu-panel" id="nav-panel" data-menu-panel>
          <div class="menu-panel__inner">
            <div class="menu-panel__glow"></div>
            <div class="menu-cluster">
              <p class="menu-label" data-i18n="menu.cluster.orbit">Orbit</p>
              <a href="index.html" aria-current="page" data-i18n="menu.link.hub">Hub</a>
              <a href="story-orbit.html" data-i18n="menu.link.storyOrbit">Story Orbit</a>
              <a href="operations.html" data-i18n="menu.link.operations">Operations &amp; Setup</a>
            </div>
            <div class="menu-cluster">
              <p class="menu-label" data-i18n="menu.cluster.beverage">Beverage & Treats</p>
              <a href="caffe.html" data-i18n="menu.link.caffe">Bar & Drinks</a>
              <a href="sweet-treats.html" data-i18n="menu.link.sweetTreats">Sweet Treat Atelier</a>
              <a href="pastries.html" data-i18n="menu.link.pastries">Pastry Lab</a>
            </div>
            <div class="menu-cluster">
              <p class="menu-label" data-i18n="menu.cluster.gelato">Gelato & Speciali</p>
              <a href="slitti-yoyo.html" data-i18n="menu.link.slittiYoyo">Slitti & Yo-Yo</a>
              <a href="gelato-lab.html" data-i18n="menu.link.gelatoLab">Gelato Lab</a>
              <a href="festive.html" data-i18n="menu.link.festive">Festive & Churros</a>
            </div>

            <div class="menu-lang menu-lang--panel" data-lang-selector>
              <details>
                <summary class="menu-lang__summary">
                  <span class="menu-lang__label" data-lang-label>Lingua</span>
                  <span class="menu-lang__current" data-lang-current>Italiano</span>
                </summary>
                <div class="menu-lang__options" role="radiogroup" aria-label="Lingua">
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="it" aria-checked="true">Italiano</button>
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="en" aria-checked="false">English</button>
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="es" aria-checked="false">Espa√±ol</button>
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="fr" aria-checked="false">Fran√ßais</button>
                </div>
              </details>
            </div>
          </div>
        </div>
      </nav>

      <section class="hero hero--orbit">
        <div class="hero-focus">
          <div class="badge">
            <span data-i18n="hub.badge">Training Orbit</span>
          </div>
          <p class="hero-eyebrow" data-i18n="hub.eyebrow">Hub operativo ¬∑ aggiornato ogni giorno</p>
          <h1 data-i18n="hub.title">Playbook operativo Badiani 1932</h1>
          <p class="hero-lede" data-i18n="hub.lede">
            Tradizione fiorentina, rituali di boutique e procedure digitalizzate in un'unica plancia: consulta, ripassa e chiudi i quiz per riscattare gelati reali.
          </p>
          <div class="hero-actions">
            <button class="btn btn-primary" type="button" data-menu-toggle aria-controls="nav-panel" data-i18n="hub.openCategories">Apri categorie</button>
            <button class="btn btn-ghost" type="button" data-info-launch data-i18n="hub.rules">Regolamento</button>
          </div>
        </div>
        <aside class="hero-aside">
          <section class="carousel carousel--cockpit carousel--cockpit-grid" data-carousel="cockpit" data-summary>
            <header class="carousel-header" data-carousel-header>
              <div class="carousel-header__title-block">
                <p class="summary-eyebrow" data-i18n="cockpit.eyebrow">Orbit cockpit</p>
                <h2 class="carousel-title" data-carousel-title data-i18n="cockpit.title">Panoramica live</h2>
                <span class="carousel-category" data-i18n="cockpit.sub">Scorri le schede e resta sempre sul pezzo.</span>
              </div>
              <div class="carousel-indicators" data-carousel-indicators aria-label="Indicatori panoramica" data-i18n-attr="aria-label:cockpit.indicatorsAria"></div>
            </header>

            <div class="carousel-track" data-carousel-track>
              <!-- DAILY CARD -->
              <article class="hub-card hub-card--daily" data-carousel-item>
                <div class="hub-card__top">
                  <span data-i18n="cockpit.daily.eyebrow">Training</span>
                </div>
                <div class="hub-card__center">
                  <div class="hub-card__icon">üìÖ</div>
                  <h3 class="hub-card__title" data-i18n="cockpit.daily.title">Training quotidiano</h3>
                </div>
                <div class="hub-card__bottom">
                  <p class="summary-card__question" data-daily-question data-i18n="cockpit.daily.loading">Caricamento...</p>
                  <p class="summary-card__hint" data-i18n="cockpit.daily.hint" style="margin-top:8px; font-size:11px;">Guadagna stelline extra.</p>
                </div>
              </article>

              <!-- PERFORMANCE CARD -->
              <article class="hub-card hub-card--stats" data-carousel-item>
                <div class="hub-card__top">
                  <span data-i18n="cockpit.perf.eyebrow">Oggi</span>
                </div>
                <div class="hub-card__center">
                  <span class="hub-card__big-text hub-card__big-text--gold" data-perf-stars>0</span>
                  <span class="stat-label" data-i18n="cockpit.stat.stars">Stelle</span>
                </div>
                <div class="hub-card__bottom">
                  <div class="summary-stats">
                    <div class="stat">
                      <span class="stat-label" data-i18n="cockpit.stat.gelatiWon">Gelati</span>
                      <span class="stat-value" data-perf-gelati>0</span>
                    </div>
                    <div class="stat">
                      <span class="stat-label" data-i18n="cockpit.stat.quizCorrect">Quiz OK</span>
                      <span class="stat-value" data-perf-quiz-correct>0</span>
                    </div>
                  </div>
                </div>
              </article>

              <!-- TOTALS CARD -->
              <article class="hub-card hub-card--stats summary-card--totals" data-carousel-item>
                <div class="hub-card__top">
                  <span data-i18n="cockpit.totals.eyebrow">Storico</span>
                </div>
                <div class="hub-card__center">
                  <span class="hub-card__big-text" data-perf-gelati-total>0</span>
                  <span class="stat-label" data-i18n="cockpit.totals.gelati">Gelati Totali</span>
                </div>
                <div class="hub-card__bottom">
                  <div class="summary-stats">
                    <div class="stat">
                      <span class="stat-label" data-i18n="cockpit.totals.stars">Stelle Tot</span>
                      <span class="stat-value" data-perf-stars-total>0</span>
                    </div>
                    <div class="stat">
                      <span class="stat-label" data-i18n="cockpit.totals.bonus">Bonus</span>
                      <span class="stat-value" data-perf-bonus-total>0</span>
                    </div>
                  </div>
                </div>
              </article>

              <!-- WRONG CARD -->
              <article class="hub-card hub-card--list" data-carousel-item>
                <div class="hub-card__top">
                  <span data-i18n="cockpit.wrong.eyebrow">Errori</span>
                </div>
                <div class="hub-card__center">
                  <span class="hub-card__big-text" data-wrong-count>0</span>
                  <span class="stat-label">Recenti</span>
                </div>
                <div class="hub-card__bottom">
                  <button class="btn btn-ghost btn--sm" type="button" data-wrong-view-all data-i18n="cockpit.wrong.viewAll">Vedi tutti</button>
                  <!-- Hidden list for JS logic compatibility -->
                  <ul class="summary-list" data-wrong-list hidden></ul>
                </div>
              </article>

              <!-- HISTORY CARD -->
              <article class="hub-card hub-card--list" data-carousel-item>
                <div class="hub-card__top">
                  <span data-i18n="cockpit.history.eyebrow">Giorni</span>
                </div>
                <div class="hub-card__center">
                  <div class="hub-card__icon">üìä</div>
                  <span class="stat-label" data-i18n="cockpit.history.title">Storico</span>
                </div>
                <div class="hub-card__bottom">
                   <!-- Hidden list for JS logic compatibility -->
                   <ul class="summary-list" data-history-days hidden></ul>
                   <p class="summary-card__hint" style="font-size:11px;">Attivit ultimi 14 giorni</p>
                </div>
              </article>

              <!-- PROFILE CARD -->
              <article class="hub-card hub-card--profile" data-carousel-item>
                <div class="hub-card__top">
                  <span data-i18n="cockpit.profile.eyebrow">Profilo</span>
                </div>
                <div class="hub-card__center" data-profile>
                   <div class="summary-profile__avatar summary-profile__avatar--placeholder" aria-hidden="true" style="transform: scale(1.5); margin-bottom: 10px;">
                      <img id="hub-profile-img" src="" alt="Avatar" style="width:100%; height:100%; object-fit:cover; display:none; border-radius:50%;">
                      <span class="avatar-placeholder" role="img" aria-label="Profilo">üë§</span>
                   </div>
                   <h3 class="hub-card__title" data-profile-nick>‚Äî</h3>
                   <span class="stat-label" data-profile-gelato>‚Äî</span>
                </div>
                <div class="hub-card__bottom">
                  <div class="profile-actions" style="display:flex; gap:8px; justify-content:center; margin-top:8px;">
                    <button class="btn btn-primary" type="button" data-profile-edit data-i18n="cockpit.profile.changeGelato" style="padding:6px 12px; font-size:11px;">Modifica</button>
                    <button class="btn btn-ghost" type="button" data-profile-switch data-i18n="cockpit.profile.switchProfile" style="padding:6px 12px; font-size:11px;">Cambia</button>
                  </div>
                </div>
              </article>
            </div>
          </section>
        </aside>
      </section>

      <!-- CHAT ASSISTANT - Messenger-style (Berny) -->
      <section class="chat-container chat-berny" aria-label="Chat con BERNY" data-i18n-attr="aria-label:assistant.aria">
        <header class="chat-header chat-header--compact">
          <div class="chat-header-text">
            <h2 class="chat-title" data-i18n="assistant.title">Parla con BERNY</h2>
            <p class="chat-subtitle" data-i18n="assistant.eyebrow">Assistente</p>
          </div>
        </header>

        <div class="chat-body">
          <div class="chat-avatar-sticky" aria-hidden="true">
            <div class="avatar-container" data-chat-avatar>
              <lottie-player
                src="public/berny-avatar.json"
                background="transparent"
                speed="1"
                style="width: 50px; height: 50px;"
                loop
                autoplay
              ></lottie-player>
            </div>
          </div>

          <div class="messages-area chat-thread" data-messages-area>
            <!-- Il messaggio verr√† iniettato via JS nella lingua giusta -->
          </div>
        </div>

        <div class="chat-input-container">
          <input
            type="text"
            class="chat-input"
            placeholder="Chiedi a BERNY‚Ä¶"
            data-chat-input
            data-i18n-attr="placeholder:assistant.inputPlaceholder"
            aria-label="Scrivi messaggio"
          />
          <button class="chat-send-btn" type="button" data-chat-send aria-label="Invia">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
            </svg>
          </button>
        </div>
      </section>
    </main>

    <div class="menu-drawer" data-menu-drawer aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="menu-drawer-title">
      <div class="menu-drawer__overlay" data-menu-close></div>
      <div class="menu-drawer__panel">
        <header class="menu-drawer__header">
          <div>
            <h2 id="menu-drawer-title" class="menu-drawer__title" data-i18n="drawer.categories">Categorie</h2>
            <p class="menu-drawer__mood" data-menu-mood data-i18n="mood.2">Brilla: i dettagli fanno la differenza.</p>
          </div>
          <button type="button" class="menu-drawer__close" data-menu-close aria-label="Chiudi menu" data-i18n-attr="aria-label:drawer.close">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
              <path d="M18 6L6 18M6 6l12 12"/>
            </svg>
          </button>
        </header>
        <nav class="menu-drawer__nav">
          <ul class="menu-categories">
            <li><a href="story-orbit.html" data-i18n="menu.link.storyOrbit">Story Orbit</a></li>
            <li><a href="operations.html" data-i18n="menu.link.operations">Operations &amp; Setup</a></li>
            <li><a href="caffe.html" data-i18n="menu.link.caffe">Bar & Drinks</a></li>
            <li><a href="sweet-treats.html" data-i18n="menu.link.sweetTreats">Sweet Treat Atelier</a></li>
            <li><a href="pastries.html" data-i18n="menu.link.pastries">Pastry Lab</a></li>
            <li><a href="slitti-yoyo.html" data-i18n="menu.link.slittiYoyo">Slitti & Yo-Yo</a></li>
            <li><a href="gelato-lab.html" data-i18n="menu.link.gelatoLab">Gelato Lab</a></li>
            <li><a href="festive.html" data-i18n="menu.link.festive">Festive & Churros</a></li>
          </ul>
        </nav>

        <div class="menu-drawer__footer">
          <!-- Footer Funzionale (Settings + Lang) -->
          <div class="menu-footer-actions" style="display: flex; flex-direction: column; gap: 12px;">
            <button class="menu-action-btn" onclick="openProfileSettings()" style="width: 100%; justify-content: flex-start;">
              <span class="icon">üë§</span> <span data-i18n="nav.profileLabel">Profilo</span>
            </button>
            
            <div class="menu-lang" data-lang-selector>
              <details>
                <summary class="menu-lang__summary">
                  <div style="display:flex; align-items:center; gap:8px;">
                    <span class="icon">üåç</span>
                    <span class="menu-lang__label" data-lang-label>Lingua</span>
                  </div>
                  <span class="menu-lang__current" data-lang-current>Italiano</span>
                </summary>
                <div class="menu-lang__options" role="radiogroup" aria-label="Lingua">
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="it" aria-checked="true">Italiano</button>
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="en" aria-checked="false">English</button>
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="es" aria-checked="false">Espa√±ol</button>
                  <button type="button" class="menu-lang__option" role="radio" data-lang-option="fr" aria-checked="false">Fran√ßais</button>
                </div>
              </details>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
